/**
 * @fileoverview Firestore Security Rules for the escolar database.
 *
 * Core Philosophy:
 * This ruleset prioritizes ease of access for prototyping, while enforcing fundamental security principles.
 * All data is stored in the `/alunos/{alunoId}` collection. Access is granted to all users for reading.
 * Writes are disallowed to prevent unauthorized data modification since anonymous auth is being used.
 *
 * Data Structure:
 * All data is stored under the `/alunos/{alunoId}` collection, where `{alunoId}` corresponds to the Aluno's RM.
 *
 * Key Security Decisions:
 * - Read-only access is enabled for all authenticated users to allow free data exploration during development.
 * - Write access is completely disabled to ensure data integrity in the prototyping phase.
 * - No user listing is allowed (as there are no user documents).
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Defines rules for the /alunos/{alunoId} collection.
     * @path /alunos/{alunoId}
     * @allow (get, list) Any signed-in user can read any Aluno document.
     * @deny (create, update, delete) No user can create, update, or delete Aluno documents.
     * @principle Allows public read access for prototyping. Disables write access for security.
     */
    match /alunos/{alunoId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    // Helper function to determine if a user is signed in.
    function isSignedIn() {
      return request.auth != null;
    }
  }
}