{
  "entities": {
    "XlsxFile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "XlsxFile",
      "type": "object",
      "description": "Represents an uploaded XLSX file and its associated data.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the XLSX file entity."
        },
        "fileName": {
          "type": "string",
          "description": "The original file name of the uploaded XLSX file."
        },
        "uploadDate": {
          "type": "string",
          "description": "The date and time when the XLSX file was uploaded.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "fileName",
        "uploadDate"
      ]
    },
    "ExtractedData": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ExtractedData",
      "type": "object",
      "description": "Represents data extracted from the first column of an XLSX file.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the extracted data entry."
        },
        "xlsxFileId": {
          "type": "string",
          "description": "Reference to the XlsxFile entity. (Relationship: XlsxFile 1:N ExtractedData)"
        },
        "columnValue": {
          "type": "string",
          "description": "The value extracted from the first column of the XLSX file."
        },
        "rowIndex": {
          "type": "number",
          "description": "The row index from which the data was extracted."
        }
      },
      "required": [
        "id",
        "xlsxFileId",
        "columnValue",
        "rowIndex"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/xlsxFiles/{xlsxFileId}",
        "definition": {
          "entityName": "XlsxFile",
          "schema": {
            "$ref": "#/backend/entities/XlsxFile"
          },
          "description": "Stores XLSX file metadata. Each user has their own collection of XLSX files.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the XLSX file."
            },
            {
              "name": "xlsxFileId",
              "description": "The ID of the XLSX file."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/xlsxFiles/{xlsxFileId}/extractedData/{extractedDataId}",
        "definition": {
          "entityName": "ExtractedData",
          "schema": {
            "$ref": "#/backend/entities/ExtractedData"
          },
          "description": "Stores extracted data from each XLSX file. Organized as a subcollection under each XLSX file.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the XLSX file and extracted data."
            },
            {
              "name": "xlsxFileId",
              "description": "The ID of the XLSX file from which the data was extracted."
            },
            {
              "name": "extractedDataId",
              "description": "The ID of the extracted data entry."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to store XLSX files and the extracted data from their first columns. It follows the principles of Authorization Independence and Structural Segregation. Path-based ownership is used to secure XLSX files, where each user owns their files. The extracted data is stored as subcollections under each XLSX file. The structure supports QAPs by segregating data based on ownership, enabling secure list operations within a user's own files. This approach avoids complex security rules and ensures data integrity."
  }
}